<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/base :: layout('Checkout', ~{::section})}">

<section>

<h2>Checkout</h2>

<!-- üî• Cart Items -->
<table border="1">
    <tr>
        <th>Product Name</th>
        <th>Quantity</th>
    </tr>

    <tr th:each="item : ${cartItems}">
        <td th:text="${item.productName}"></td>
        <td th:text="${item.quantity}"></td>
    </tr>
</table>

<br/>

<form th:action="@{/orders/place}" method="post">

    <!-- Hidden User ID -->
    <input type="hidden" name="userId" th:value="${userId}" />

    <h3>Select Delivery Address</h3>

    <!-- ‚úÖ Always show Add New Address -->
    <a th:href="@{/address/add}" 
       style="display:inline-block; margin-bottom:10px;">
       ‚ûï Add New Address
    </a>

    <!-- If no addresses -->
    <div th:if="${addresses == null or #lists.isEmpty(addresses)}">
        <p>No saved addresses found.</p>
    </div>

    <!-- Address List -->
    <div th:each="addr : ${addresses}" 
         style="border:1px solid #ccc; padding:10px; margin-bottom:10px;">

        <input type="radio"
               name="addressId"
               th:value="${addr.addressId}"
               required />

        <strong th:text="${addr.fullName}"></strong><br/>

        <span th:text="${addr.phoneNumber}"></span><br/>

        <span th:text="${addr.addressLine}"></span>,
        <span th:text="${addr.city}"></span>,
        <span th:text="${addr.state}"></span>,
        <span th:text="${addr.pincode}"></span>

        <br/><br/>

        <!-- ‚úÖ Edit Button -->
        <a th:href="@{'/address/edit/' + ${addr.addressId}}">
            ‚úè Edit
        </a>

    </div>

    <br/>

    <button type="submit">Place Order</button>

</form>

</section>
</html>