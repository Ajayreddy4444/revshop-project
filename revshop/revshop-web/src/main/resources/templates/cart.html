<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/base :: layout('Cart', ~{::section})}">

<section class="container mt-4">

<h2 class="mb-4">Shopping Cart</h2>

<div th:each="c : ${cart}" class="border-bottom py-4">

<div class="row align-items-center">

<!-- IMAGE -->
<div class="col-md-2">
<img th:src="@{'/images/' + ${c.imageUrl}}"
     class="img-fluid"
     style="height:130px;object-fit:contain;">
</div>

<!-- MIDDLE CONTENT -->
<div class="col-md-7">

<h5 th:text="${c.productName}"></h5>

<p class="text-success mb-1">In stock</p>

<div class="d-flex align-items-center">

<button class="btn btn-outline-dark btn-sm"
        th:onclick="'updateQty(' + ${c.productId} + ',-1)'">−</button>

<span class="mx-3 fw-bold"
      th:text="${c.quantity}"></span>

<button class="btn btn-outline-dark btn-sm"
        th:onclick="'updateQty(' + ${c.productId} + ',1)'">+</button>

<a th:href="@{'/cart/remove/' + ${c.itemId}}"
   class="btn btn-link text-danger ms-3">Delete</a>

</div>

</div>

<!-- PRICE RIGHT -->
<div class="col-md-3 text-end">

<!-- DISCOUNT PRICE -->
<h5 class="fw-bold text-danger">
₹ <span th:text="${c.price * c.quantity}"></span>
</h5>

<!-- ORIGINAL MRP -->
<div class="text-muted text-decoration-line-through"
     th:if="${c.mrp != null}">
₹ <span th:text="${c.mrp * c.quantity}"></span>
</div>

</div>


</div>

</div>


<!-- ================= CART SUBTOTAL (NEW ADDITION) ================= -->
<div class="d-flex justify-content-end mt-4">

<h4 class="fw-bold">

Subtotal (

<span th:text="${#lists.size(cart)}"></span>

items ) :

₹ <span
th:text="${#numbers.formatDecimal(
#aggregates.sum(cart.![(price * quantity)]),
1,'COMMA',2,'POINT')}">
</span>

</h4>

</div>
<!-- ================================================================ -->


<a th:href="@{/orders/checkout}" class="btn btn-warning mt-3">
Proceed to Checkout
</a>


<script>
function updateQty(productId,change){
fetch('/cart/add',{
method:'POST',
headers:{'Content-Type':'application/x-www-form-urlencoded'},
body:'productId='+productId+'&quantity='+change
}).then(()=>location.reload());
}
</script>

</section>
</html>