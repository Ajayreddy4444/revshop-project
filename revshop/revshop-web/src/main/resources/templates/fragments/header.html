<div th:fragment="header">
    <header style="display:flex; justify-content:space-between; align-items:center; padding:10px 20px;">

        <h2>RevShop</h2>

        <!-- Bell Icon -->
        <div style="position:relative; cursor:pointer;"
             onclick="handleBellClick()">

            <i class="fa fa-bell" style="font-size:22px;"></i>

            <!-- Notification Badge -->
            <span id="notificationCount"
                  style="display:none;
                         position:absolute;
                         top:-5px;
                         right:-8px;
                         background:red;
                         color:white;
                         font-size:12px;
                         padding:3px 6px;
                         border-radius:50%;">
            </span>
        </div>

    </header>

    <!-- ðŸ”¥ AUTO LOAD NOTIFICATION COUNT -->
    <script th:inline="javascript">

        const headerUserId = /*[[${session.userId}]]*/ null;

        function loadHeaderNotificationCount() {

            if (!headerUserId) return;

            fetch(`http://localhost:8080/api/notifications/${headerUserId}`)
                .then(res => res.json())
                .then(data => {

                    if (!data) return;

                    const unread = data.filter(n => !n.seen).length;

                    const badge = document.getElementById("notificationCount");

                    if (!badge) return;

                    if (unread > 0) {
                        badge.style.display = "block";
                        badge.innerText = unread;
                    } else {
                        badge.style.display = "none";
                    }
                })
                .catch(() => {});
        }

        // ðŸ”” PROFESSIONAL BELL CLICK HANDLER
        function handleBellClick() {

            if (!headerUserId) {
                window.location.href = "/notifications";
                return;
            }

            // Mark all as seen
            fetch(`http://localhost:8080/api/notifications/markAllSeen/${headerUserId}`, {
                method: "PUT"
            })
            .then(() => {

                // Immediately hide badge
                const badge = document.getElementById("notificationCount");
                if (badge) {
                    badge.style.display = "none";
                }

                // Redirect to notifications page
                window.location.href = "/notifications";
            })
            .catch(() => {
                window.location.href = "/notifications";
            });
        }

        window.addEventListener("load", loadHeaderNotificationCount);

    </script>

</div>